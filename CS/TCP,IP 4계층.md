# TCP/IP 4계층

### TCP/IP 4계층이란?

- 4계층이란 장치들이 인터넷 상에서 데이터를 주고받을때 쓰는 독립적인 프로토콜의 집합을 의미한다.
- 애플리케이션 계층, 전송 계층, 인터넷 계층, 링크계층(네트워크계층)으로 구성된다.

### 애플리케이션 계층이란?

- HTTP, SMTP, SSH, FTP가 대표적이며 웹서비스, 이메일 등 서비스를 실직적으로 제공하는 층이다.

### 전송 계층이란?

- TCP, UDP가 대표적이다.
- 애플리케이션계층에서 받은 메시지를 세그먼트 또는 데이터그램으로 쪼갠다.
- 데이터가 오류없이 순서대로 전달되도록 도움을 주는 층이다.

### 인터넷 계층이란?

- IP, ICMP, ARP가 대표적이다.
- 전송 계층에서 받은 세그먼트 또는 데이터그램을 패킷화 하여 목적지로 전송한다.

### 링크 계층이란?

- 링크 계층은 전선, 광섬유, 무선 등으로 데이터가 네트워크를 통해 물리적으로 전송되는 방식을 정의한다.

### 캡슐화와 비캡슐화

- 캡슐화란 송신자가 수신자에게 데이터를 보낼 때 데이터가 각 계층을 지나며 각 계층의 특징들이 담긴 헤더들이 붙여지는 과정을 의미한다.
- 비캡슐화란 캡슐화의 역과정으로 수신자측에서는 캡슐화된 데이터를 역순으로 제거하면서 응용계층까지 도달하는 것이다.

### 각 계층의 PDU

- PDU는 각 계층의 데이터 단위를 의미한다.
- 애플리케이션 계층 → 메시지
- 전송 계층
    - → 세그먼트(TCP), 데이터그램(UDP)
- 인터넷 계층
    - → 패킷
    - 세그먼트에 SP(송신자IP), DP(수신자IP)가 포함된 IP헤더가 붙은 조각이다.
- 링크 계층
    - → 프레임(데이터 링크 계층), 비트(물리 계층)
    - 패킷에 MAC주소 헤더와 CRC,체크섬 트레일러가 붙은 조각이다.

### CRC/체크섬 트레일러란?

- 데이터 오류감지를 위한 수학함수가 적용된값이다.
- 링크의 오류로 인해 데이터 손상을 감지하는 역할을 한다.

### TCP/IP 4계층과 OSI 7계층의 차이점은?

![image](https://user-images.githubusercontent.com/76714485/230735484-5f842fc8-4d91-4e16-8349-cb1283521e6b.png)

- OSI7계층은 TCP/IP 4계층을 좀더 세부적으로 쪼갠 계층이다.

---

### MTU란?

- MTU란 네트워크에 연결된 장치가 받아들일 수 있는 최대 데이터 패킷의 크기를 말한다.
- MTU를 기준으로 데이터는 쪼개져서 패킷화된다.

### 패킷이 분할되지 않는 경우

- 패킷을 분할할 수 없어 MTU를 초과할 때 전달을 아예 하지 않을 수 있다.
- IPv6는 분할을 허용하지 않는다.
- IPv4의 헤더의 flags의 값이 1이면 분할을 불가 설정할 수 있다.

### MTU와 MSS

![image](https://user-images.githubusercontent.com/76714485/230735500-9226b12f-e530-49b2-93e9-fe3bace2c654.png)

- MTU는 IP헤더와 TCP헤더의 크기까지 합친값이고
- MSS는 데이터크기 즉 페이로드 크기만을 가리킨다.

### PMTUD

- PMTUD는 수신자와 송신자의 경로 상에서 장치가 패킷을 누락한 경우 테스트 패킷을 낮추면서 MTU에 맞게끔 반복해서 보내는 과정이다.

---

### HTTP

- HTTP는 주로 서버와 브라우저간에 데이터를 주고받기 위해 설계된 프로토콜이다.
- 요즘에는 서버와 서버간의 통신할떄도 많이 이용한다.
- 장점으로는
    - HTTP는 헤더를 통한 확장이 쉽다.
    - HTTP는 stateless한다. 즉 연속적으로 수행되는 사이에 연속적 상태값은 없다.

### SSH

- SSH는 보안되지 않은 네트워크에서 서비스를 안전하게 운영하는 암호화 네트워크 프로토콜이다.

### FTP

- FTP는 File Transfer Protocol의 약자로 노드와 노드간의 파일을 전송하는데 사용하는 프로토콜이다.
- 현재는 암호화해서 전송하는 FTPS, SFTP로 대체된다.

### SMTP

- 인터넷을 통해 메일을 보낼 때 사용되는 프로토콜이다.

---

### TCP

- **가상회선패킷교환방식이다.**
    - 가상적인 회선을 만든 후 순서대로 패킷을 전송한다.
- **다양한 오류검사 매커니즘**
    - 재전송 → 시간 초과 기간이 지나면 서버는 전달되지 않은 데이터에 대해 재전송을 시도한다.
    - 체크섬 → 송신된 데이터의 체크섬과 수신된 데이터의 체크섬 값을 비교해서 값이 올바르게 왔는지 확인힌다.
- **헤더**
    - 20~60바이트로 유동적이다.
    - 헤더에는 출발지, 목적지, ack, 체크섬 등 다양한 정보가 있다.

### UDP

- **데이터그램패킷교환방식이다.**
    - 순서 상관없이 보낸다.
- 오류검사는 체크섬만 지원한다.
- 헤더는 8바이트로 고정이다.

---

### ICMP

- 노드와 노드사이에 통신이 잘되는지 확인할때 쓰는 프로토콜이다.
- 비연결형 프로토콜을 기반으로 구축된다.
